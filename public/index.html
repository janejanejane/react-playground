<!DOCTYPE html>
<!-- <html lang="en">
<head>
    <meta charset="UTF-8">
    <title></title>
    <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
<head>
<body>
    <div id="root"></div>
    <script src="bundle.min.js"></script>
</body>
</html> -->

<html>
	<head>
		<title>Simple Line Graph using SVG and d3.js</title>
    <script src="//d3js.org/d3.v3.min.js"></script>
		<style>
		path {
stroke: steelblue;
stroke-width: 1;
fill: none;
}

rect {
cursor: pointer;
}

.graph-svg {
padding-top: 20px;
margin-left: -15px;
}

g.y.axis {
stroke-dasharray: 3;
}

g.slant text {
font-style: italic;
}

.axis path,
.axis line {
fill: none;
stroke: #8c8c8c;
shape-rendering: crispEdges;
}

.x.axis line {
stroke: transparent;
}

.x.axis text {
fill: #8c8c8c;
}

.x.axis g.active text {
fill: #00395d;
}

.x.axis path,
.y.axis path {
display: none;
}

.y.axis line {
stroke-dasharray: 3;
}

.line {
fill: none;
stroke: steelblue;
stroke-width: 1.5px;
}

.prevColor {
fill: white;
stroke: #00395d;
stroke-opacity: 0.3;
stroke-width: 2;
stroke-dasharray: 6,2;
}

.currColor {
fill: white;
stroke: #00395d;
stroke-width: 2;
}

.prevColor2 {
fill: #aeaeae;
stroke: red;
stroke-opacity: 0.3;
stroke-width: 2;
stroke-dasharray: 6,2;
}

.currColor2 {
fill: #aeaeae;
stroke: blue;
stroke-width: 2;
}

/* FOR DONUT */
.arc text {
font: 10px sans-serif;
text-anchor: middle;
}

.arc path {
stroke: #fff;
cursor: pointer;
}

.text-tooltip {
text-anchor: middle;
}

g.unselected {
opacity: 0.2
}

g.neutral {
opacity: 1;
}

text.cloak {
display: none;
}

/* FOR ARC */

.foreground-arc {
fill: #72a309;
stroke: white;
}

.background-arc {
fill: #e6efca;
stroke: white;
}



/*** end - d3 CHART STYLES ***/


.banking-select {
min-width: auto !important;
}
		</style>
	</head>
	<body>


	<div id="graph" class="aGraph" style="position:absolute;top:0px;left:0; float:left;"></div>
	<div id="outside"></div>

	<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0/jquery.js"></script>



		<script>
		;(function( global ) {
	  'use strict';

	  // internal variables
	  var x = d3.scale.linear(), y = d3.scale.linear(), line = d3.svg.line().interpolate( 'linear' ),
	  bars, graphXRange, graphYRange, xAxisSpace = 0.5;

	  // function constructor called when instantiated
	  var NineSd3 = function( options ) {
	    return new NineSd3.init( options );
	  };

	  // expose public methods
	  NineSd3.prototype = {
	    // combine all of the array of values to get the min and max for axis ranges
	    _getRange: function( data ) {
	      var result = [];
	      for ( var i in data ) {
	        result.push( data[ i ].values );
	      }

	      return [].concat.apply( [], result ).sort( function( a, b ) { return a - b; } );
	    },

	    // retain values that are not nulls
	    _removeNulls: function( data ) {
	      return data.filter( function( i ) { return i !== null; } );
	    },

	    _extendProperties: function( options ) {
	        if ( options && typeof options === 'object' ) {
	          for ( var i in options ) {
	            this.properties[ i ] = options[ i ];
	          }
	        }
	    },

	    // this handles the mouseover event
	    _mouseOver: function( svg ) {
	    	var that = this;

	    	console.log( 'this is svg:', svg );
	    	return function( d, i ) {

		      var data = that.properties.data;

		      for ( var val in data ) {
		        var record = data[ val ];
		        that._updateCircle( svg )( record.values, i, record.className );
		      }

		      svg.select( '.x.axis g:nth-child(' + ( i + 1 ) + ')')
		        .attr( 'class', 'active');
		    }
	    },

	    // this handles the mouseout event
	    _mouseOut: function( svg ) {
	    	var that = this;

	    	return function( d, i ) {
		      var data = that.properties.data;

		      for ( var val in data ) {
		        var record = data[ val ];
		        that._updateCircle( svg )( record.values, i, record.className, true );
		      }

		      svg.selectAll( '.x.axis g' )
		        .attr( 'class', 'tick' );
		    }
	    },

	    // this handles the circle locations on the graph
	    _updateCircle: function( svg ) {
	    	return function( data, index, lineColor, isMouseOut ) {

		      if ( !!data[ index ] ) {

		        var total = data.length - 1, xVal = index + xAxisSpace, yVal = data[ index ];

		        // put the circle to the right end of the line
		        if ( isMouseOut ) {
		          xVal = ( total + xAxisSpace );
		          yVal = data[ total ];
		        }

		        svg.select( 'circle.' + lineColor )
		          .attr( 'cx', x( xVal ) )
		          .attr( 'cy', y( yVal ) );
		      }
		    }
	    },

	    // update the line graph data
	    updateLineData: function( container, options ) {

	      this.properties.data = this._extendProperties( options );

	      var allValues = this._getRange( options.data );
	      if ( !!allValues.length ) {
			allValues = this._removeNulls( allValues );
			console.log( allValues );
	      }

	      // update the domain and range for y-axis
	      y.domain( d3.extent( allValues ) )
	        .range( [ graphYRange, 0 ] );

	      var chart = d3.select( container ).transition();

	      for ( var val in options.data ) {
			var record = options.data[ val ];
			var total = record.values.length - 1;

			chart.selectAll( 'path.' + record.className )
				.duration( this.properties.movement )
				.attr( 'd', line( record.values ) );

			d3.select( 'circle.' + record.className )
				.transition()
				.duration( this.properties.movement )
				.attr( 'cx', x( total + xAxisSpace ) )
				.attr( 'cy', y( record.values[ total ] ) );
	      }

	      var g = d3.select( container ).select( 'g' );
	      bars.on( 'mouseover.update', this._mouseOver( g ) )
	          .on( 'mouseout.update', this._mouseOut( g ) );
	    },

	    // update the arc graph data
	    updateArcData: function( container, options ) {

	    },

	    getHoverArea: function( cb ) {
	    	return cb( bars );
	    },

	    // this will put a line chart on the dom in the container provided
	    lineChart: function( container ) {

	      if ( !container ) {
	        throw 'Graph container not specified.';
	      }

	      var that = this, innerAxisLength = 35, tickInterval = 3, circleRadius = 3,
	        allValues = that._getRange( that.properties.data ),
	        graphXRange = that.properties.width - that.properties.margin.left - that.properties.margin.right,
	        graphYRange = that.properties.height - that.properties.margin.top - that.properties.margin.bottom;

	      var svg = d3.select( container ).append( 'svg' )
	          .attr( 'width', that.properties.width )
	          .attr( 'height',  that.properties.height )
	          .attr( 'class', 'graph-svg' )
	        .append( 'g' )
	          .attr( 'transform', 'translate(' + that.properties.margin.left + ', 0 )' );

	      // put all the data values in one big array so we know the min and max
	      // then get rid of the null values
	      if ( !!allValues.length ) {
	        allValues = that._removeNulls( allValues );
	        console.log( allValues );
	      }

	      // fit the x-axis on the container width
	      x.domain( [ 0, that.properties.xValues.length ] )
	        .range( [ 0, graphXRange ] );

	      // fit the y-axis on the container height
	      y.domain( d3.extent( allValues ) )
	        .range( [ graphYRange, 0 ] );

	      // define the line
	      line.x( function( d, i ) {
	          return x( i + xAxisSpace );
	        })
	        .y( function( d, i ) {
	          return y( d );
	        });

	      var xAxis = d3.svg.axis()
	        .scale( x )
	        .tickValues( that.properties.xValues.map( function( d, i ) {
	          return i;
	        }))
	        .tickFormat( function( d, i ) {
	          return that.properties.xValues[ d ][ i ];
	        })
	        .orient( 'bottom' );

	      var yAxis = d3.svg.axis()
	        .scale( y )
	        .tickValues( y.ticks() )
	        .tickSize( 10 )
	        .tickPadding( 5 )
	        .tickFormat( function( d, i ) {
	        	// use existing number formatting
	        	// return NumberFormatter.formatGraphLabel( d );
						return d;
	        })
	        .orient( 'left' );

	      var setLine = function( data, lineColor ) {
	        // draws the line onto the chart
	        // ensures that there is not fill value because this is not an area line chart
	        svg.append( 'path' )
	          .datum( data )
	          .attr( 'd', line( data ) )
	          .attr( 'class', lineColor )
	          .style( 'fill', 'transparent' )
	      };

	      var setCircle = function( data, lineColor ) {
	        var total = data.length - 1;

	        console.log( 'this is total:', total, data );

	        svg.append( 'g' )
	          .append( 'circle' )
	          .attr( 'cx', x( total + xAxisSpace ) )
	          .attr( 'cy', y( data[ total ] ) )
	          .attr( 'r', circleRadius )
	          .attr( 'class', lineColor );
	      };

	      // manipulate the x-axis
	      var customXAxis = function( g ) {
	        g.selectAll( 'text' )
	          .attr( 'dx', ( graphXRange / that.properties.xValues.length ) / 2 )
	          .attr( 'dy', 10 );
	      };

	      // manipulate the y-axis
	      var customYAxis = function( g ) {
	        g.selectAll( 'line' )
	          .attr( 'x2', function( d, i ) {

	            // adjust the length of the line per interval specified
	            // because there is no tick number
	            if ( i % tickInterval !== 0 ) {
	              return graphXRange + innerAxisLength;
	            }

	            // use original line length
	            return graphXRange;
	          })

	        g.selectAll( '.tick' )
	          .attr( 'transform', function( d, i ) {
	            var t = d3.transform( d3.select( this ).attr( 'transform' ) ).translate;

	            // after the line length is adjusted above,
	            // move it to the left to align with the tick numbers of other lines
	            if ( i % tickInterval !== 0 ) {
	              return 'translate(' + ( -innerAxisLength ) + ',' + t[ 1 ] + ')';
	            }

	            // if the line is not part of the tick interval,
	            // use original place
	            return 'translate(' + t[ 0 ] + ',' + t[ 1 ] + ')';
	          });

	        g.selectAll( 'text' )
	          .attr( 'dy', function( d, i ) {

	            // if the tick text is part of the interval specified, show it
	            if ( i % tickInterval === 0 ) {
	              return i;
	            }

	            // remove the tick text because the line length is changed above
	            d3.select( this ).remove();
	          })
	      };

	      // add a hover area, a rect tag
	      bars = svg.selectAll( '.hover-rect' ).data( that.properties.xValues );

	      // draw the graph column backgrounds
	      svg.selectAll( '.graph-columns' )
	          .data( that.properties.xValues )
	        .enter().append( 'rect' )
	          .attr( 'x', function( d, i ) {
	            return i * ( graphXRange / that.properties.xValues.length );
	          })
	          .attr( 'y', 10 )
	          .attr( 'width', ( graphXRange / that.properties.xValues.length - 1 ) )
	          .attr( 'height', graphYRange - 12 )
	          .attr( 'fill', function( d, i ) {

	            // no column color needed
	            if ( !that.properties.columnColor ) {
	              return 'transparent';
	            }

	            // separate every x-axis by transparent and column color specified
	            return ( ( i + 1 ) % 2 === 0 ) ? 'transparent' : that.properties.columnColor;
	          });

	      // include the lines and circle now
	      for ( var val in that.properties.data ) {
	        var record = that.properties.data[ val ];
	        setLine( record.values, record.className );
	        setCircle( record.values, record.className );
	      }

	      // draw the x-axis with modifications
	      svg.append( 'g' )
	        .attr( 'class', 'x axis' )
	        .attr( 'transform', 'translate( 0, ' + graphYRange + ')' )
	        .style( 'fill', that.properties.axisColor )
	        .call( xAxis )
	        .call( customXAxis );

	      // draw the y-axis with modifications
	      svg.append( 'g' )
	        .attr( 'class', 'y axis slant' )
	        .style( 'fill', that.properties.axisColor )
	        .call( yAxis )
	        .call( customYAxis );

	      // add the bars that will handle the hover event of the graph,
	      // these bars are transparent
	      bars.enter().append( 'rect' )
	        .attr( 'x', function( d, i ) {
	          return i * ( graphXRange / that.properties.xValues.length );
	        })
	        .attr( 'y', 10 )
	        .attr( 'width', ( graphXRange / that.properties.xValues.length - 1 ) )
	        .attr( 'height', graphYRange + 20 )
	        .attr( 'fill', 'transparent' )
	        .attr( 'class', 'hover-rect' );

	      // add mouse events
	      bars.on( 'mouseover', that._mouseOver( svg ) )
	        .on( 'mouseout', that._mouseOut( svg ) );

	      return this;
	    },

	    arcChart: function( container ) {

	      if ( !container ) {
	        throw 'Graph container not specified.';
	      }

	      var that = this, tau = 2 * Math.PI, radius = Math.min( that.properties.width, that.properties.height ) / 2;

	      var arc = d3.svg.arc()
	        .innerRadius( 40 )
	        .outerRadius( 60 )
	        .startAngle( 0 );

	      var svg = d3.select( container ).append( 'svg' )
	          .attr( 'width', that.properties.width )
	          .attr( 'height', that.properties.height )
	        .append( 'g' )
	          .attr( 'transform', 'translate(' + ( that.properties.width / 2 ) + ',' + ( that.properties.height / 2 ) + ')' );

	      // draw background of arc
	      svg.append( 'path' )
	        .datum( { endAngle: tau } )
	        .attr( 'class', 'background-arc' )
	        .attr( 'd', arc );

	      // draw foreground of arc
	      svg.append( 'path' )
	        .datum( { endAngle: ( that.properties.data / 100 ) * tau } )
	        .attr( 'class', 'foreground-arc' )
	        .attr( 'd', arc );

	      // draw the upper text value in the center of the arc
	      svg.append( 'text' )
	        .attr( 'x', 0 )
	        .attr( 'y', 10 )
	        .attr( 'class', 'text-tooltip' )
	        // .attr( 'font-weight', 'bold' )
	        .attr( 'transform', 'translate( 0, -20)' )
	        .style( 'font-size', ( radius / 4.5 ) + 'px' )
	        .text( that.properties.text );

	      // draw the lower text value in the center of the arc
	      svg.append( 'text' )
	        .attr( 'x', 0 )
	        .attr( 'y', 10 )
	        .attr( 'class', 'text-tooltip' )
	        .attr( 'font-weight', 'bold' )
	        .attr( 'transform', 'translate( 0, 10)' )
	        .style( 'font-size', ( radius / 2.5 ) + 'px' )
	        .text( that.properties.data );

	      return this;
	    }

	  };

	  NineSd3.init = function( options ) {
	    this.properties = {
	      axisColor: 'gray',
	      columnColor: '#fbfbfb',
	      columnColor: '#aeaeae',
	      data: [
	        {
	          values: [ 12, 67, 46, 90, 42, 55, -30 ],
	          className: 'prevColor'
	        },
	        {
	          values: [ 89, 54, null, 76, 48 ],
	          className: 'currColor'
	        },
	        {
	          values: [ 40, 98, 76, 23, 11, 43, 65 ],
	          className: 'currColor2'
	        }
	      ],
	      height: 75,
	      height: 170,
	      margin: {
	        top: 20,
	        right: 15,
	        bottom: 20,
	        left: 45
	      },
	      min: -50,
	      max: 150,
	      movement: 1000,
	//      width: 133,
	      width: 285,
	      xValues: [
	        { 0: '1' }, { 1: '2' }, { 2: '3' }, { 3: '4' }, { 4: '5' }, { 5: '6' },
	        { 6: '7' }, { 7: '8' }, { 8: '9' }, { 9: '10' }, { 10: '11' }, { 11: '12' }
	      ]
	    };

	    this._extendProperties( options );
	  };

	  NineSd3.init.prototype = NineSd3.prototype;

	  global.NineSd3 = NineSd3;
	}( window ));

	var details = [
	  {
	    values: [ 1256, 6767, 4866, 9650, 4452, 5325, 3023 ],
	    className: 'prevColor'
	  },
	  {
	    values: [ 8659, 3456, 4534, 7646, 4348 ],
	    className: 'currColor'
	  }
	];

	var nineCharting = new window.NineSd3( details );
	nineCharting.lineChart( '#outside' );

		</script>
	</body>
</html>
