<!DOCTYPE html>
<!-- <html lang="en">
<head>
    <meta charset="UTF-8">
    <title></title>
    <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
<head>
<body>
    <div id="root"></div>
    <script src="bundle.min.js"></script>
</body>
</html> -->

<html>
	<head>
		<title>Simple Line Graph using SVG and d3.js</title>
    <script src="//d3js.org/d3.v3.min.js"></script>
		<style>
			/* tell the SVG path to be a thin blue line without any area fill */
			path {
				stroke: steelblue;
				stroke-width: 1;
				fill: none;
			}

			.axis {
			  shape-rendering: crispEdges;
			}

			.x.axis line {
			  stroke: lightgrey;
			}

			.x.axis .minor {
			  stroke-opacity: .5;
			}

			.x.axis path {
			  display: none;
			}

			.y.axis line, .y.axis path {
			  fill: none;
			  stroke: #000;
			}
		</style>
	</head>
	<body>


	<div id="graph" class="aGraph" style="position:absolute;top:0px;left:0; float:left;"></div>


	<script>
	var margin = {top: 20, right: 80, bottom: 30, left: 50},
	    width = 960 - margin.left - margin.right,
	    height = 500 - margin.top - margin.bottom;

	var prevDataset = [ 12, 67, 46, 90, 42, 55, 30 ];

	var currDataset = [ 89, 54, ((76-54)/2), 76, 48 ];

	var xValues = [
	  { 0: 'SUN' }, { 1: 'MON' }, { 2: 'TUE' }, { 3: 'WED' }, { 4: 'THU' }, { 5: 'FRI' }, { 6: 'SAT' }
	];

	var barRange = Object.keys( xValues ).map( function( d, i ) {
	  return i * ( width / xValues );
	})

	var x = d3.scale.linear()
	    .domain([ 0, xValues.length ])
	    .range([ 0, width]);

	var y = d3.scale.linear()
	    .domain([ 0, d3.max( prevDataset ) + margin.top ])
	    // .domain([ 0, d3.max( prevDataset ) ])
	    .range([height, 0]);

	var xAxis = d3.svg.axis()
	    .scale( x )
	    .tickSize( -height )
	    .tickValues( xValues.map( function( d, i ) {
	      console.log( xValues[ i ] );
	      // return xValues[ index ];
	      return i;
	    }))
	    .tickFormat( function( d, i ) {
	      console.log( d[ i ] );
	      return xValues[ d ][ i ];
	    })
	    .orient( 'bottom' );

	var yAxis = d3.svg.axis()
	    .scale(y)
	    .tickSize( -width )
	    .orient( 'left' );

	var barAxis = d3.scale.ordinal()
	    .domain( Object.keys( xValues ).map( function( d ) {
	      return xValues[ d ];
	    }))
	    .range( barRange );

	var line = d3.svg.line()
	    .interpolate( 'linear' )
	    .x( function ( d, i ) {
	      return x( i + 0.5 );
	    })
	    .y( function( d, i ) {
	      return y( d );
	    });

	var setLine = function( data, lineColor ) {
	  var path = svg.append( 'path' )
	    .datum( data )
	    .attr( 'd', line( data ) )
	    .style( 'stroke-width', 2 )
	    .style( 'stroke', lineColor );
	};

	var svg = d3.select('body').append('svg')
	    .attr( 'width', width + margin.left + margin.right )
	    .attr( 'height', height + margin.top + margin.bottom )
	  .append( 'g' )
	    .attr( 'transform', 'translate(' + margin.left + ',' + margin.top + ')' );

	console.log( xValues, Object.keys( xValues ) );
	var bars  = svg.selectAll( 'rect' )
	    .data( xValues )
	  .enter().append( 'rect' )
	    .attr( 'x', function( d, i ) {
	      console.log( 'd is: ', d );
	      console.log( 'i is: ', i );
	      return i * ( width / xValues.length );
	    })
	    .attr( 'y', 0 )
	    .attr( 'width', width / xValues.length - 1 )
	    .attr( 'height', height )
	    .attr( 'fill', function( d, i ) {
	      console.log( 'i am in fill!!!', d, i );
	      return ( ( i + 1 ) % 2 === 0 ) ? '#e8e8e8' : 'transparent';
	    });

	setLine( prevDataset, 'red' );
	setLine( currDataset, 'blue' );

	// create the x-axis ticks
	svg.append( 'g' )
	    .attr( 'class', 'x axis' )
	    .attr( 'transform', 'translate(0,' + height + ')' )
	    .call(xAxis);

	svg.selectAll( '.x.axis text' )
	    .attr( 'dx', ( ( width / xValues.length ) / 2 ) )
	    .attr( 'dy', 20 );

	// create the y-axis ticks
	svg.append( 'g' )
	    .attr( 'class', 'y axis' )
	    .call( yAxis );

	var lastPrevItem = prevDataset[ prevDataset.length - 1 ];
	var lastCurrItem = currDataset[ currDataset.length - 1 ];
	var circleRadius = 5;

	var prevCircle = svg.append( 'g' )
	    .append( 'circle' )
	    .attr( 'cx', x( ( prevDataset.length - 1 ) + 0.50 ) )
	    .attr( 'cy', y( lastPrevItem ) )
	    .attr( 'r', circleRadius )
	    .attr( 'stroke', 'red' )
	    .attr( 'stroke-width', 2 );

	var currCircle = svg.append( 'g' )
	    .append( 'circle' )
	    .attr( 'cx', x( ( currDataset.length - 1 ) + 0.50 ) )
	    .attr( 'cy', y( lastCurrItem ) )
	    .attr( 'r', circleRadius )
	    .attr( 'stroke', 'blue' )
	    .attr( 'stroke-width', 2 );

	bars.on( 'mouseover', function( d, i ) {
	      console.log( 'prev: ', prevDataset[ i ], ' curr: ', currDataset[ i ] );
	      if ( !!prevDataset[ i ] ) {
	        prevCircle.attr( 'cx', x( i + 0.50 ) );
	        prevCircle.attr( 'cy', y( prevDataset[ i ] ) );
	      }

	      if ( !!currDataset[ i ] ) {
	        currCircle.attr( 'cx', x( i + 0.50 ) );
	        currCircle.attr( 'cy', y( currDataset[ i ] ) );
	      }
	    })
	    .on( 'mouseout', function( d, i ) {
	      prevCircle.attr( 'cx', x( ( prevDataset.length - 1 ) + 0.50 ) );
	      prevCircle.attr( 'cy', y( lastPrevItem ) );
	      currCircle.attr( 'cx', x( ( currDataset.length - 1 ) + 0.50 ) );
	      currCircle.attr( 'cy', y( lastCurrItem ) );
	    });
	</script>



	</body>
</html>
